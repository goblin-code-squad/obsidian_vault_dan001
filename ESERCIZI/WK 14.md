Appunti Assignment Week 14 per gli assenti! (chi vuole aggiunga roba!)

- Partire dal proprio lavoro o prendere la soluzione pubblicata a discrezione.

- Per controllare se una colonna non ha doppioni:

Select colonna from tabella  
group by colonna  
having count(colonna) > 1

es: 

```sql

select
	ids_giorno,
	count(*) as conteggio_duplicati
from
openbo_dwh.dim_tempo_inizio dti
group by
	ids_giorno -- raggruppa tutte le righe con la stessa data
having
	count(*) > 1;
```

- Nome mese si può ricavare con EXTRACT
- Dim_responasabile: sostituire i prefissi elencati. Vari modi, quello più “semplice” è usare CASE WHEN con SUBSTRING() ma attenzione all’ordine.
- Fact table → fare il lookup  con le join stando attenti a non duplicare i dati!

→ la durata si calcola  come differenza tra data fine e data inizio ove data fine >= data inizio, null negli altri casi  
→ loadtimestamp → da calcolare nelle dimensione dell’assignment 12, sarà quello da mantenere nel fact table

- Check_import → attenzione ai tipi dati! La somma fra float(4) e numeric non quadra. Cambiare quindi i tipi dati in landing come numeric (::NUMERIC).

"Abbiamo due opzioni:  
- usare la soluzione proposta dai trainer  
- oppure andare avanti con la nostra soluzione  
- ci sono due query da sistemare che sono quelle di import  
  
La buona notizia è che nessuno ha fatto tutto perfettamente, tutti avevano o il double counting o altro  
La soluzione data è diversa ma se abbiamo un id univoco per ogni soggetto e se la ragione sociale non si ripete su quella dimensione possiamo andare avanti  
  
verifica con il GROUP BY + HAVING  
  
scegli la colonna da verificare tipo ids_atto per verificare di aver fatto  
  
select ids_atto  
from dim_atto.ids_Atto  
GROUP BY  
e HAVING (è WHERE applicato al GROUP BY ma prima raggruppa e poi calcola) COUNT (ids_atto >1)  
  
Controllare così scopriamo dove abbiamo i dati duplicati  
  
Se vogliamo usare esattamente l'ETL che ha usato Andrea gli scriviamo per fare l'import della LANDING ZONE  
  
Oltre alle 4 dimensioni servono le 3 dimensioni mancanti + il FATTO + le tabelle di errore  
  
Che LANDING/INTEGRATION/  
  
Indicatore importo  
colonna layer e colonna sorgente  
  
Importante poi nelle dimensioni di inizio e di fine è chiamare l'inizio senza INIZIO ma solo con l'anno mentre la fine con _____ underscore  ___fine  
  
La parte DIM_RESPONSABILE dove ci sono le varia diciture elencate è più complessa e difficile.  
Il modo più semplice è fare il TRIM di SUBSTRING cercando le sottostringhe.  
  
Con molti casi diversi devo cercare con CASE WHEN  
  
Occhio all'ordine con cui fate le cose.  
Parto da quelli con più caratteri.  
Se faccio il LIKE mettere il % solo alla fine.  
  
Ricordarsi dopo aver fatto le query di non cancellare l'originale per sapere come tornare indietro.  
  
Per IL FATTO si fa LOOKUP per cercare i valori e dopo controlliamo sempre con la QUERY DI QUADRATURA  
  
Nel caricamento dell'integration aggiungere TIMESTAMP.  
  
Due tabelle di errore con istruzioni.  
  
Importo NULL potreste non aver nulla, esempio la Mareddu.  
  
Nell'IMPORTO alla fine è facile un  
GROUP BY SUM  
  
Ma devi avere lo stesso formato NUMERIC perchè non puoi sommare FLOAT con NUMERIC  
  
	Prima di fare la GROUP BY devi fare il CAST a numeric."